<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>League Odds | PA Milk Society</title>
  <link rel="stylesheet" href="odds.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="navbar">
      
      <div class="logo">
        <a href="../league.html" class="back-link">← Back to Hub</a>
      </div>

      <h1 class="league-title">PA Milk Society</h1>

      <div class="menu-toggle" id="menuToggle" aria-label="Open menu" aria-expanded="false" aria-controls="navMenu">
        <div></div><div></div><div></div>
      </div>

      <nav class="nav-links" id="navMenu" role="menu">
        <a href="../league.html" role="menuitem">League Hub</a>
        <a href="../standings/standings.html" role="menuitem">Standings</a>
        <a href="../players/players.html" role="menuitem">Managers</a>
        <a href="../history/history.html" role="menuitem">League History</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="hero-left">
        <h2>Season Odds Center</h2>
        <p class="sub">Live probabilities and projections for the current season</p>
      </div>
      <div class="hero-right">
        <div class="pill">Updated <span id="lastUpdated">—</span></div>
      </div>
    </section>

    <section class="grid">
      <!-- Championship odds ranking -->
      <article class="panel span-2">
        <header class="panel-h">
          <h3>Best Odds to Win Title</h3>
        </header>
        <ol id="titleOdds" class="rank-list"></ol>
      </article>

      <!-- Division odds -->
      <article class="panel">
        <header class="panel-h">
          <h3>Conference Odds</h3>
        </header>
        <div id="divisionOdds" class="div-grid"></div>
      </article>

      <!-- Record projections -->
       <article class="panel span-3">
        <header class="panel-h">
          <h3>Post Week 5 Record Predictions</h3>
        </header>
        <table class="tbl" id="recordTbl" aria-label="Record predictions">
          <thead>
            <tr>
              <th>Manager</th>
              <th>Proj W L</th>
              <th>Playoff%</th>
              <th>Bye%</th>
              <th>Miss%</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </article>
      
      <article class="panel span-3">
        <header class="panel-h">
          <h3>Pre-Season Record Predictions</h3>
        </header>
        <table class="tbl" id="preseasonRecordTbl" aria-label="Preseason record predictions">
          <thead>
            <tr>
              <th>Manager</th>
              <th>Proj W L</th>
              <th>Playoff%</th>
              <th>Bye%</th>
              <th>Miss%</th>
            </tr>
          </thead>
        <tbody></tbody>
        </table>
      </article>

      <!-- Extra markets -->
      <article class="panel">
        <header class="panel-h">
          <h3>Pre-Season Picks</h3>
        </header>
        <ul id="preseason_extraMarkets" class="bullets"></ul>
      </article>
      <article class="panel">
        <header class="panel-h">
          <h3>New Favorites</h3>
        </header>
        <ul id="extraMarkets" class="bullets"></ul>
      </article>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 PA Milk Society</p>
  </footer>

  <script>
    // nav
    const btn = document.getElementById('menuToggle');
    const menu = document.getElementById('navMenu');
    function toggleMenu() {
      menu.classList.toggle('show');
      btn.classList.toggle('active');
      btn.setAttribute('aria-expanded', menu.classList.contains('show'));
    }
    btn.addEventListener('click', toggleMenu);
    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !btn.contains(e.target)) {
        if (menu.classList.contains('show')) toggleMenu();
      }
    });

    // helpers
    const pct = n => `${(Number(n) || 0).toFixed(1)}%`;
    const wl = o => `${o.wins}-${o.losses}`;
    const bar = (p) => {
  const v = Math.max(0, Math.min(100, Number(p) || 0));
  return `
    <div class="bar">
      <span style="width:${v}%"><em>${v.toFixed(1)}%</em></span>
    </div>
  `;
};

    async function loadOdds(){
      const res = await fetch('odds.json', { cache: 'no-store' });
      if (!res.ok) { console.error('Failed to load odds.json'); return; }
      const data = await res.json();

      // stamp
      document.getElementById('lastUpdated').textContent = data.updated || '—';

      // title odds ordered
      const list = document.getElementById('titleOdds');
      list.innerHTML = '';
      (data.title_odds || []).sort((a,b)=> b.prob - a.prob).forEach((row, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="row">
            <span class="rank">${i+1}</span>
            <span class="name">${row.manager}</span>
            ${bar(row.prob)}
          </div>
        `;
        const arrow = row.delta > 0
  ? `<span class="arrow up">▲ ${row.delta}</span>`
  : row.delta < 0
    ? `<span class="arrow down">▼ ${Math.abs(row.delta)}</span>`
    : `<span class="arrow same">–</span>`;

li.innerHTML = `
  <div class="row">
    <span class="rank">${i+1}</span>
    <span class="name">${row.manager} ${arrow}</span>
    ${bar(row.prob)}
  </div>
`;

        list.appendChild(li);
      });

      // division odds grouped
      const divBox = document.getElementById('divisionOdds');
      divBox.innerHTML = '';
      (data.division_odds || []).forEach(div => {
        const card = document.createElement('div');
        card.className = 'div-card';
        card.innerHTML = `
          <h4>${div.division}</h4>
          ${div.teams.map(t => `
            <div class="div-row">
              <span class="name">${t.manager}</span>
              ${bar(t.win_prob)}
            </div>
          `).join('')}
        `;
        const arrowFor = d => d > 0
  ? `<span class="arrow up">▲ ${d}</span>`
  : d < 0
    ? `<span class="arrow down">▼ ${Math.abs(d)}</span>`
    : `<span class="arrow same">•</span>`;

card.innerHTML = `
  <h4>${div.division}</h4>
  ${div.teams.map(t => `
    <div class="div-row">
      <span class="name">${t.manager} ${arrowFor(t.delta || 0)}</span>
      ${bar(t.win_prob)}
    </div>
  `).join('')}
`;
        divBox.appendChild(card);
      });

      // helper stays the same
const pct = n => `${(Number(n) || 0).toFixed(1)}%`;
const wl  = o => `${o.wins}-${o.losses}`;

// generic renderer for any record table by id
function renderRecordTable(tblId, rows){
  const tbody = document.querySelector(`#${tblId} tbody`);
  if (!tbody || !Array.isArray(rows)) return;
  tbody.innerHTML = '';
  rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.manager}</td>
      <td>${wl(r)}</td>
      <td>${pct(r.playoff_prob)}</td>
      <td>${pct(r.bye_prob)}</td>
      <td>${pct(r.miss_prob)}</td>
    `;
    tbody.appendChild(tr);
  });
}

// inside loadOdds after you fetch data:
renderRecordTable('recordTbl', data.record_projections);
renderRecordTable('preseasonRecordTbl', data.preseason_record_projections);


      // extra markets
      const preseason_extra = document.getElementById('preseason_extraMarkets');
      preseason_extra.innerHTML = '';
      (data.preseason_extra_markets || []).forEach(m => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${m.market}:</strong> ${m.value}`;
        preseason_extra.appendChild(li);
      });

      const extra = document.getElementById('extraMarkets');
      extra.innerHTML = '';
      (data.extra_markets || []).forEach(m => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${m.market}:</strong> ${m.value}`;
        extra.appendChild(li);
      });
    }

    loadOdds().catch(console.error);
  </script>
</body>
</html>
